# this file contains deployable types and is the early-stage backing for the
# deployable type registry service
_BASE_NODE_DOC = """
<cluster xmlns="http://www.globus.org/2008/06/workspace/metadata/logistics">
 <workspace>
   <name>%(node_name)s</name>
   <image>ami-d49e76bd</image>
   <quantity>1</quantity>
   <nic wantlogin="true">public</nic>
   <ctx>
     <provides>
       <identity/>
     </provides>
     <requires>
       <identity/>
       <data name="chef-install-work-consumer"><![CDATA[%(spec)s]]></data>
     </requires>
   </ctx>
 </workspace>
</cluster>
""" 

_EPU_WORK_CONSUMER_SPEC = """
{
  "capabilitycontainer":{
    "broker":"amoeba.ucsd.edu",
    "bootscript":"res/scripts/newcc.py",
    "sysname":"cei",
    "lcaarch_branch":"cei-lcaarch",
    "lcaarch_commit_hash":"HEAD"
  },
  "username":"cc",
  "services":{
    "work_consumer":"{'name':'work_consumer','module':'ion.services.cei.work_consumer','class':'WorkConsumerService'}"
  },
  "recipes":["setuptools", "twisted", "txamqp", "user", "capabilitycontainer"]
}
"""

_EPU_WORK_CONSUMER_DOC = _BASE_NODE_DOC % {'node_name' : 'work_consumer',
        'spec' : _EPU_WORK_CONSUMER_SPEC}

_REGISTRY = {
    'epu_work_consumer' :
    {
        'document' : _EPU_WORK_CONSUMER_DOC,
        'sites' : {
            'ec2-east' : {
                'work_consumer' : {
                    'image' : 'ami-d49e76bd',
                },
            },
        }
    },
    'base-cluster' :
    {
        'document' : 
        '<cluster>'+
        '<workspace><name>head-node</name><image>base-cluster</image>'+
        '<quantity>1</quantity></workspace>'+
        '<workspace><name>worker-node</name><image>base-cluster</image>'+
        '<quantity>3</quantity></workspace>'+
        '</cluster>',
        'sites' : {
            'ec2-west' : {
                'head-node' : {
                    'image' : 'ami-XXXXX',
                },
                'worker-node' : {
                    'image' : 'ami-XXXXX',
                }
            },
            'nimbus-test' : {
                'head-node' : {
                    'image' : 'base-cluster',
                },
                'worker-node' : {
                    'image' : 'base-cluster',
                }
            }
        }
    }
}

