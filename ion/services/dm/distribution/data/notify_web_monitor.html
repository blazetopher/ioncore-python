<html>
    <head>
        <title>Notification Monitor</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
        <style>
            body {
                font-family: helvetica, sans-serif;
                font-size: 11pt;
                background-color: #efefef;
                margin: 0px;
            }
            #header {
                background-color: white;
                color: #333;
                border-bottom: 1px solid black;
                padding: 10px;
                height: 30px;
            }   
        </style>
    </head>
    <body>
        <div id='header'>
            <input id="lastslice" type="hidden" value="0" />
            <input type="button" id="stopupdates" value="Stop" />
            <input type="button" id="logreg" value="Log Reg" />
        </div>
        <ul id="log"></ul>
    </body>
    <script type="text/javascript">
        var intervalID;
        $(document).ready(function() { 

            var timeoutid = null;

            function dowork(lasttime, callback)
            {
                req = "/data/" + lasttime;
                console.log("bout to request " + req);

                $.getJSON(req, function(data) {
                    intervalID = window.setTimeout(dowork, 2000, data.lasttime, callback);           
                    callback(data);
                });
            }

            dowork('', function(data) {
                console.log(data);

                // find existing ul with name

                for (var i = 0; i < data.data.length; i++)
                {
                    var curdata = data.data[i]; 
                    console.log("name: " + curdata.name + " msgs: " + curdata.logs.length);
                    ul = $('ul#' + curdata.name);
                    if (ul.length == 0)
                    {
                        ul = $('<ul/>', {'id': curdata.name});
                        ul.appendTo('body');
                    }

                    for (var j = 0; j < curdata.logs.length; j++)
                        $('<li>' + curdata.logs[j] + '</li>').appendTo(ul);
                }
            });

            //intervalID = window.setInterval(function() {
            //    req = "/data" + $('input#lastslice').val();
            //    $.getJSON(req, function(data) {
            //        $('ul#log').append(data.html);
            //        $('input#lastslice').val(data.lastindex);
            //    });
            //}, 2000);

            function getData()
            {
                req = "/data/stuff"
                $.getJSON(req, function(data) {
                    console.log(data);
                });
            }
            //getData();

            $('input#stopupdates').click(function() { 
                //window.clearInterval(intervalID);
                window.clearTimeout(intervalID);
            });

            $('input#logreg').click(function() {
                $.getJSON('/ctl/_log', function(data) {});
            });
        });
    </script>
</html>

